<!-- pages/profile/profile.wxml -->
<view class="profile-container">
  <!-- ç”¨æˆ·ä¿¡æ¯å¡ç‰‡ - ç»Ÿä¸€è“è‰²èƒŒæ™¯ -->
  <view class="user-card content-module">
    <view class="user-header">
      <view class="avatar-section">
        <view class="avatar-circle">
          <text class="avatar-text">{{userInfo.nickName ? userInfo.nickName[0] : 'ç”¨'}}</text>
        </view>
        <view class="user-info">
          <text class="user-name">{{userInfo.nickName || 'å¾®ä¿¡ç”¨æˆ·'}}</text>
          <text class="user-id">ID: {{openid ? openid.substring(0, 8) + '...' : 'åŠ è½½ä¸­...'}}</text>
          <text class="register-time">æ³¨å†Œæ—¶é—´: {{formatDate(registerTime)}}</text>
        </view>
      </view>
      <button wx:if="{{!userInfo.nickName}}" class="login-btn" bindtap="handleLogin">ç«‹å³ç™»å½•</button>
    </view>
    
    <!-- ç”¨æˆ·ç»Ÿè®¡ -->
    <view class="user-stats-grid">
      <view class="user-stat-item">
        <text class="user-stat-number">{{totalTasks}}</text>
        <text class="user-stat-label">æ€»ä»»åŠ¡æ•°</text>
      </view>
      <view class="user-stat-item">
        <text class="user-stat-number">{{completedTasks}}</text>
        <text class="user-stat-label">å·²å®Œæˆ</text>
      </view>
      <view class="user-stat-item">
        <text class="user-stat-number">{{completionRate}}%</text>
        <text class="user-stat-label">å®Œæˆç‡</text>
      </view>
      <view class="user-stat-item">
        <text class="user-stat-number">{{totalDuration}}</text>
        <text class="user-stat-label">æ€»æ—¶é•¿</text>
      </view>
    </view>
  </view>

  <!-- åŠŸèƒ½èœå• -->
  <view class="menu-section content-module">
    <view class="section-title">åŠŸèƒ½è®¾ç½®</view>
    <view class="menu-list">
      <view class="menu-item" bindtap="goToPlan">
        <view class="menu-left">
          <text class="menu-icon">ğŸ“…</text>
          <text class="menu-text">æˆ‘çš„è®¡åˆ’</text>
        </view>
        <text class="menu-arrow">â€º</text>
      </view>
      
      <view class="menu-item" bindtap="goToStats">
        <view class="menu-left">
          <text class="menu-icon">ğŸ“Š</text>
          <text class="menu-text">æ•°æ®ç»Ÿè®¡</text>
        </view>
        <text class="menu-arrow">â€º</text>
      </view>
      
      <view class="menu-item" bindtap="goToAddTask">
        <view class="menu-left">
          <text class="menu-icon">â•</text>
          <text class="menu-text">æ·»åŠ ä»»åŠ¡</text>
        </view>
        <text class="menu-arrow">â€º</text>
      </view>
    </view>
  </view>

  <!-- åå¥½è®¾ç½® -->
  <view class="preference-section content-module">
    <view class="section-title">åå¥½è®¾ç½®</view>
    <view class="menu-list">
      <view class="menu-item">
        <view class="menu-left">
          <text class="menu-icon">ğŸŒ™</text>
          <text class="menu-text">æ·±è‰²æ¨¡å¼</text>
        </view>
        <switch class="setting-switch" checked="{{false}}" disabled />
      </view>
      
      <view class="menu-item">
        <view class="menu-left">
          <text class="menu-icon">ğŸ””</text>
          <text class="menu-text">æ¶ˆæ¯æé†’</text>
        </view>
        <switch class="setting-switch" checked="{{true}}" />
      </view>
      
      <view class="menu-item">
        <view class="menu-left">
          <text class="menu-icon">ğŸ¤–</text>
          <text class="menu-text">AIä¼˜åŒ–å»ºè®®</text>
        </view>
        <switch class="setting-switch" checked="{{true}}" />
      </view>
    </view>
  </view>

  <!-- æœ€è¿‘ä»»åŠ¡ -->
  <view class="recent-tasks-section content-module">
    <view class="section-header">
      <text class="section-title">æœ€è¿‘ä»»åŠ¡</text>
      <text class="see-all" bindtap="goToPlan">æŸ¥çœ‹å…¨éƒ¨</text>
    </view>
    
    <view class="task-list">
      <block wx:for="{{recentTasks}}" wx:key="_id">
        <view class="task-item status-{{item.status}}" bindtap="goToTaskDetail" data-taskid="{{item._id}}">
          <view class="task-main">
            <text class="task-title">{{item.title}}</text>
            <view class="task-meta">
              <text class="task-date">{{formatTaskDate(item.date)}}</text>
              <text class="task-time">{{item.scheduled_start}} - {{item.scheduled_end}}</text>
            </view>
          </view>
          <view class="task-status">
            <text class="status-text {{item.status}}">{{getStatusText(item.status)}}</text>
          </view>
        </view>
      </block>
      
      <view wx:if="{{recentTasks.length === 0}}" class="empty-tasks">
        <text class="empty-icon">ğŸ“</text>
        <text class="empty-text">è¿˜æ²¡æœ‰ä»»åŠ¡è®°å½•</text>
        <button class="add-task-btn" bindtap="goToAddTask">å»æ·»åŠ ä»»åŠ¡</button>
      </view>
    </view>
  </view>

  <!-- åº•éƒ¨æ“ä½œæ  -->
  <view class="profile-bottom-bar bottom-action-bar">
    <button class="support-btn" bindtap="contactSupport">
      <text class="support-icon">ğŸ’</text>
      <text>è”ç³»å®¢æœ</text>
    </button>
    <button class="logout-btn" bindtap="showLogoutConfirm" wx:if="{{userInfo.nickName}}">
      <text class="logout-icon">ğŸšª</text>
      <text>é€€å‡ºç™»å½•</text>
    </button>
  </view>
</view>